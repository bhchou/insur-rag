apiVersion: apps/v1
kind: Deployment
metadata:
  name: rag-web
  labels:
    app: insur-rag
spec:
  replicas: 1
  # ğŸ”¥ é‡è¦ï¼šRWO ç¡¬ç¢Ÿä¸æ”¯æ´å¤š Pod åŒæ™‚å¯«å…¥ï¼Œæ›´æ–°æ™‚å¿…é ˆå…ˆæ®ºèˆŠçš„
  strategy:
    type: Recreate
  selector:
    matchLabels:
      app: insur-rag
  template:
    metadata:
      labels:
        app: insur-rag
    spec:
      containers:
        # --- [1] ä¸»ç¨‹å¼ (Rust RAG) ---
        - name: rag-web
          image: rag_web # Kustomize æœƒè‡ªå‹•æ›¿æ›æˆå®Œæ•´ Image URL
          imagePullPolicy: Always
          ports:
            - containerPort: 8081 # Rust App çš„ Port
          
          # æ³¨å…¥ ConfigMap è£¡çš„è®Šæ•¸ (PATH éƒ½åœ¨é€™è£¡)
          envFrom:
            - configMapRef:
                name: rag-config
            - secretRef:
                name: rag-secrets
          
          securityContext: {}

          volumeMounts:
            
            # B. è¨­å®šå±¤ (æ”¾ Prompt) -> æ›è¼‰åˆ° /app/config
            - name: config-volume
              mountPath: "/app/config"
              readOnly: true
          
          # è³‡æºé™åˆ¶
          resources:
            requests:
              memory: "2Gi"
              cpu: "100m"
            limits:
              memory: "8Gi"
              cpu: "2"
 
      volumes:
        # å®šç¾© ConfigMap
        - name: config-volume
          configMap:
            name: rag-config
            items:
              - key: "system_prompt.txt"
                path: "system_prompt.txt"